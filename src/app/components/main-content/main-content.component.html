<section class="main-content-container">
    @if (showVideo()) {
    <app-video-item [video]="videoToPlay()" (favoriteVideosUpdated)="updateFavorite()
      " (closeVideoClick)="showVideo.set($event)" />
    }

    <app-main-content-header />

    <div class="main-video-content">
        @if (favoriteVideos().length > 0) {
        <div class="video-content-category-container">
            <h1>My Favorite</h1>
            <div class="video-content-category">
                @if (visibleArrows()['favorite']) {
                <div class="arrowLeft">
                    <button (click)="scrollLeft('favorite')">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                </div>
                }

                <div class="video-content-category-scroll" #favoriteScrollContainer [attr.data-category]="'favorite'">
                    @for (video of favoriteVideos(); track $index) {
                    <div class="video-content-item" [class.is-disabled]="!isVideoReady(video)"
                        (click)="isVideoReady(video) && handleVideoClick(video)">
                        @if (isVideoProcessing(video)) {
                        <div class="video-loading">
                            <div class="spinner"></div>
                            <span>Processing…</span>
                        </div>
                        } @else if (hasVideoError(video)) {
                        <div class="video-error-thumb">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                            <span>Failed</span>
                        </div>
                        } @else {
                        <img [src]="video.image_file" [alt]="video.title" loading="lazy" />
                        }
                    </div>
                    }
                </div>

                @if (visibleArrows()['favorite']) {
                <div class="arrowRight">
                    <button (click)="scrollRight('favorite')">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
                }
            </div>
        </div>
        }

        @for (entry of groupedVideos() | keyvalue; track $index) {
        <div class="video-content-category-container">
            <h1>{{ entry.key }}</h1>
            <div class="video-content-category">
                @if (visibleArrows()[entry.key]) {
                <div class="arrowLeft">
                    <button (click)="scrollLeft($index)">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                </div>
                }

                <div class="video-content-category-scroll" #scrollContainer [attr.data-category]="entry.key">
                    @for (video of entry.value; track $index) {
                    <div class="video-content-item" [class.is-disabled]="!isVideoReady(video)"
                        (click)="isVideoReady(video) && handleVideoClick(video)">
                        @if (isVideoProcessing(video)) {
                        <div class="video-loading">
                            <div class="spinner"></div>
                            <span>Processing…</span>
                        </div>
                        } @else if (hasVideoError(video)) {
                        <div class="video-error-thumb">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                            <span>Failed</span>
                        </div>
                        } @else {
                        <img [src]="video.image_file" [alt]="video.title" loading="lazy" />
                        }
                    </div>
                    }
                </div>

                @if (visibleArrows()[entry.key]) {
                <div class="arrowRight">
                    <button (click)="scrollRight($index)">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
                }
            </div>
        </div>
        }
    </div>
</section>